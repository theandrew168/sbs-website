<!doctype html><html lang=en><head><title>Simple Cookies in Go · Shallow Brook Software
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Andrew Dailey"><meta name=description content="Today&rsquo;s blog post is about cookies!
Not the chocolate chip kind, but the web application state managemant kind.
In short, cookies! are bits of data (represented as name-value pairs) that web servers can request clients (mostly browsers) to store.
Since HTTP is a stateless protocol, it is useful to have a way to remember pieces of information between requests.
Often, cookies are used for identification and tracking purposes (like those obnoxious pop-ups you see on many sites).
For my projects, however, cookies are primarly used for session management and determining if a user is authenticated."><meta name=keywords content="blog,developer,personal"><meta name=fediverse:creator content><meta name=twitter:card content="summary"><meta name=twitter:title content="Simple Cookies in Go"><meta name=twitter:description content="Today’s blog post is about cookies! Not the chocolate chip kind, but the web application state managemant kind. In short, cookies! are bits of data (represented as name-value pairs) that web servers can request clients (mostly browsers) to store. Since HTTP is a stateless protocol, it is useful to have a way to remember pieces of information between requests. Often, cookies are used for identification and tracking purposes (like those obnoxious pop-ups you see on many sites). For my projects, however, cookies are primarly used for session management and determining if a user is authenticated."><meta property="og:url" content="https://shallowbrooksoftware.com/posts/simple-cookies-in-go/"><meta property="og:site_name" content="Shallow Brook Software"><meta property="og:title" content="Simple Cookies in Go"><meta property="og:description" content="Today’s blog post is about cookies! Not the chocolate chip kind, but the web application state managemant kind. In short, cookies! are bits of data (represented as name-value pairs) that web servers can request clients (mostly browsers) to store. Since HTTP is a stateless protocol, it is useful to have a way to remember pieces of information between requests. Often, cookies are used for identification and tracking purposes (like those obnoxious pop-ups you see on many sites). For my projects, however, cookies are primarly used for session management and determining if a user is authenticated."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-15T00:00:00+00:00"><meta property="article:tag" content="Go"><link rel=canonical href=https://shallowbrooksoftware.com/posts/simple-cookies-in-go/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.e927f7340e309d76dcb8fda85f1531ae7341aa9cd0b7f3ab77885dae77b1a0a2.css integrity="sha256-6Sf3NA4wnXbcuP2oXxUxrnNBqpzQt/Ord4hdrnexoKI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://shallowbrooksoftware.com/>Shallow Brook Software
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://shallowbrooksoftware.com/posts/simple-cookies-in-go/>Simple Cookies in Go</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-09-15T00:00:00Z>September 15, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/go/>Go</a></span></div></div></header><div class=post-content><p>Today&rsquo;s blog post is about cookies!
Not the chocolate chip kind, but the web application state managemant kind.
In short, <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies class=external-link target=_blank rel=noopener>cookies</a>! are bits of data (represented as name-value pairs) that web servers can request clients (mostly browsers) to store.
Since HTTP is a stateless protocol, it is useful to have a way to remember pieces of information between requests.
Often, cookies are used for identification and tracking purposes (like those obnoxious pop-ups you see on many sites).
For my projects, however, cookies are primarly used for session management and determining if a user is authenticated.</p><p>There are two varieties of cookies: <strong>session</strong> and <strong>permanent</strong>.
Session cookies disappear when the user closes their browser and ends the current session.
Permanent cookies, on the other hand, remain in the browser until they expire (with a lifetime recommended by the server).
The name &ldquo;permanent&rdquo; is somewhat confusing since they aren&rsquo;t <em>actually</em> permanent: they just persist bewteen browser sessions until they eventually expire.</p><h2 id=actions>Actions
<a class=heading-link href=#actions><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In my Go-based web projects, I use cookies for session management.
When a user logs in, the server generates a random &ldquo;session ID&rdquo; value (using the <a href=https://pkg.go.dev/crypto/rand class=external-link target=_blank rel=noopener>crypto/rand</a> package).
Then, the HTTP response includes a <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie class=external-link target=_blank rel=noopener>Set-Cookie</a> header asking the browser to set a cookie with the provided name, value, max age, and other settings.
In a typical configuration, cookies will be included in subsequent requests to the same server.</p><p>In general, I seem to only ever perform one of three actions:</p><ol><li>Creating <strong>session</strong> cookies</li><li>Creating <strong>permanent</strong> cookies</li><li>Creating <strong>expired</strong> cookies</li></ol><p>Let&rsquo;s see how each of these actions are implemented as Go functions.</p><h2 id=newsessioncookie>NewSessionCookie
<a class=heading-link href=#newsessioncookie><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>This is the &ldquo;foundation&rdquo; helper upon which the other two are built.
It creates a cookie with the given name and value while providing reasonable defaults for the seldom-changed details.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Create a session (not permanent) cookie that expires when the user&#39;s session ends.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewSessionCookie</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>string</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Cookie</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cookie</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Cookie</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Name</span>:     <span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Value</span>:    <span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Path</span>:     <span style=color:#e6db74>&#34;/&#34;</span>,  <span style=color:#75715e>// This path makes the cookie apply to the whole site.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>Domain</span>:   <span style=color:#e6db74>&#34;&#34;</span>,   <span style=color:#75715e>// An empty domain will default to the server&#39;s base domain.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>Secure</span>:   <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// Only send cookies on secure connections (includes localhost).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>HttpOnly</span>: <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// Only send cookies via HTTP requests (not JS).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// Don&#39;t send cookies with cross-site requests but include them when navigating
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// to the origin site from an external location (like when following a link).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>SameSite</span>: <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>SameSiteLaxMode</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cookie</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Since this cookie doesn&rsquo;t have an <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#expiresdate class=external-link target=_blank rel=noopener>Expires</a> or <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#max-agenumber class=external-link target=_blank rel=noopener>MaxAge</a> field, it will be removed whenever the user closes their browser session.</p><h2 id=newpermanentcookie>NewPermanentCookie
<a class=heading-link href=#newpermanentcookie><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>This helper only differs from the previous in that it accepts a &ldquo;time-to-live&rdquo; duration which is converted to seconds and returned as the cookie&rsquo;s <code>MaxAge</code> value.
The browser will see this and know that the cookie is permanent (until its <code>MaxAge</code> is lifetime exceeded).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Create a permanent (not session) cookie with a given time-to-live.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewPermanentCookie</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>ttl</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Cookie</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cookie</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewSessionCookie</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cookie</span>.<span style=color:#a6e22e>MaxAge</span> = int(<span style=color:#a6e22e>ttl</span>.<span style=color:#a6e22e>Seconds</span>())
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cookie</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Note that cookies have two very similar fields for setting their expiration: <code>Expires</code> and <code>MaxAge</code>.
Which one should you use?
<a href=https://stackoverflow.com/a/78348791 class=external-link target=_blank rel=noopener>TL;DR</a>: Use <code>MaxAge</code> because it is more reliable (since saying &ldquo;this expires in N seconds&rdquo; is less error prone than trying to provide a specific timestamp and hoping that the user&rsquo;s computer&rsquo;s time is correct).</p><h2 id=newexpiredcookie>NewExpiredCookie
<a class=heading-link href=#newexpiredcookie><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The last helper creates a cookie with a <code>MaxAge</code> of <code>-1</code>.
This tells the browser that the cookie with the given name is instantly expired (and should therefore be deleted).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Create a cookie that is instantly expired.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewExpiredCookie</span>(<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Cookie</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cookie</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewSessionCookie</span>(<span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cookie</span>.<span style=color:#a6e22e>MaxAge</span> = <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cookie</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>One important thing to note is that your system shouldn&rsquo;t depend on browsers faithfully deleting expired cookies.
Especially when dealing with sessions, you should be sure to store the same expiration info in your database so that outdated sessions can be deleted server-side.
Otherwise, a malicious client could save their cookie value and simply re-add it themselves (or just make it expire much later than you intended).</p><h2 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>That&rsquo;s it!
Over time, I&rsquo;ve converged on these three simple helpers for working with cookies.
I include these functions in almost all web-based Go projects that I work on.
While cookies have many options for tweaking their behavior, I only expose the ability to change <code>Name</code>, <code>Value</code>, and <code>MaxAge</code>.
Other details (such as <code>Path</code>, <code>Domain</code>, <code>Secure</code>, <code>HttpOnly</code>, and <code>SameSite</code>) are almost never change so I populate these values with reasonable defaults within the <code>NewSessionCookie</code> foundation helper.</p><p>If these helpers could be useful to you, feel free to try them out.
It not, I hope you at least learned something new!
Thanks for reading.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2024
Andrew Dailey
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>