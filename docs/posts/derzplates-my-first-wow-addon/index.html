<!doctype html><html lang=en><head><title>DerzPlates: My First WoW Addon · Shallow Brook Software
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Andrew Dailey"><meta name=description content="I&rsquo;ve played World of Warcraft off and on since 2007.
I spent months as a true n00b but eventually found myself a guild and a raiding spot as a balance druid (sometimes known as the &ldquo;OOMkin&rdquo;).
As I learned more about the game, I quickly discovered addons: additional, community-built software that runs inside of the game client.
Addons can do so many things: track DPS (damage per second) numbers, show what loot a boss drops, or completely redesign the user interface."><meta name=keywords content="blog,developer,personal"><meta name=fediverse:creator content><meta name=twitter:card content="summary"><meta name=twitter:title content="DerzPlates: My First WoW Addon"><meta name=twitter:description content="I’ve played World of Warcraft off and on since 2007. I spent months as a true n00b but eventually found myself a guild and a raiding spot as a balance druid (sometimes known as the “OOMkin”). As I learned more about the game, I quickly discovered addons: additional, community-built software that runs inside of the game client. Addons can do so many things: track DPS (damage per second) numbers, show what loot a boss drops, or completely redesign the user interface."><meta property="og:url" content="https://shallowbrooksoftware.com/posts/derzplates-my-first-wow-addon/"><meta property="og:site_name" content="Shallow Brook Software"><meta property="og:title" content="DerzPlates: My First WoW Addon"><meta property="og:description" content="I’ve played World of Warcraft off and on since 2007. I spent months as a true n00b but eventually found myself a guild and a raiding spot as a balance druid (sometimes known as the “OOMkin”). As I learned more about the game, I quickly discovered addons: additional, community-built software that runs inside of the game client. Addons can do so many things: track DPS (damage per second) numbers, show what loot a boss drops, or completely redesign the user interface."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-22T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-22T00:00:00+00:00"><link rel=canonical href=https://shallowbrooksoftware.com/posts/derzplates-my-first-wow-addon/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.e927f7340e309d76dcb8fda85f1531ae7341aa9cd0b7f3ab77885dae77b1a0a2.css integrity="sha256-6Sf3NA4wnXbcuP2oXxUxrnNBqpzQt/Ord4hdrnexoKI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://shallowbrooksoftware.com/>Shallow Brook Software
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://shallowbrooksoftware.com/posts/derzplates-my-first-wow-addon/>DerzPlates: My First WoW Addon</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-12-22T00:00:00Z>December 22, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
7-minute read</span></div></div></header><div class=post-content><p>I&rsquo;ve played World of Warcraft off and on since 2007.
I spent months as a true n00b but eventually found myself a guild and a raiding spot as a balance druid (sometimes known as the &ldquo;OOMkin&rdquo;).
As I learned more about the game, I quickly discovered addons: additional, community-built software that runs inside of the game client.
Addons can do so many things: track DPS (damage per second) numbers, show what loot a boss drops, or completely redesign the user interface.</p><p>Eventually, I went to college for Software Engineering.
Playing WoW since then, I&rsquo;ve always wondered: how are addons written?
What language are they written in?
What API does the client expose to addon developers?
Despite being unanswered for so many years, I finally flipped that stone over and started reading.
Then, a few weeks ago, I wrote and published my very first WoW addon!
This post talks about what the addon does, how it works, and the struggles I went through during development.</p><h1 id=derzplates>DerzPlates
<a class=heading-link href=#derzplates><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>I&rsquo;m rolling a bear druid (a tanking spec) for the latest round of WoW Classic (the <a href=http://worldofwarcraft.blizzard.com/en-us/news/24156594 class=external-link target=_blank rel=noopener>20th Anniversary Edition</a>).
As a tank, my goal to get all of the enemies to attack me while the damage dealers kill them and the healers keep everyone alive.
Unfortunately, the default UI in classic doesn&rsquo;t provide a way to indicate which enemies are attacking you.
The addon I wrote is called <a href=https://github.com/theandrew168/derzplates class=external-link target=_blank rel=noopener>DerzPlates</a> and it has single, simple goal: <strong>make it visually clear (via nameplate color) which enemy units are attacking me</strong>.</p><p>I&rsquo;m aware that some addons already exist for this (<a href=https://www.curseforge.com/wow/addons/tidy-plates-threat-plates class=external-link target=_blank rel=noopener>ThreatPlates</a> is a very popular one), but I feel like those are too heavy-handed and make too many changes to the default UI.
I <em>only</em> want to change the plate&rsquo;s color (to magenta because purple is cool) and nothing else.
Here&rsquo;s a screenshot of the addon in action.
Bonus points if you notice the Wicked reference!</p><p><img src=/images/20241222/screenshot.webp alt="Screenshot of modified nameplate color"></p><h1 id=addon-structure>Addon Structure
<a class=heading-link href=#addon-structure><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>As it turns out, WoW addons are written in <a href=https://www.lua.org/ class=external-link target=_blank rel=noopener>Lua</a>!
They live as self-contained directories within the game&rsquo;s <code>Interface/AddOns</code> folder.
To be identified and executed by the game client, the folder needs at least two files: a table of contents (<code>.toc</code>) file and a Lua (<code>.lua</code>) source code file.
That&rsquo;s it!</p><h2 id=table-of-contents>Table of Contents
<a class=heading-link href=#table-of-contents><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The <code>.toc</code> file contains basic metadata about the addon: its name, description, version, and which version of WoW client (interface) it was built for.
It then lists out any source files that the client should execute.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e>## Title: DerzPlates</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Notes: The simplest threat plates addon on the market.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Author: theandrew168</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Version: 0.0.2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Interface: 11505</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>main.lua</span>
</span></span></code></pre></div><h2 id=lua-sources>Lua Sources
<a class=heading-link href=#lua-sources><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The simplest addon could be <code>print("Hello World!")</code> which would print &ldquo;Hello World!&rdquo; to the chat window whenever the UI loads.
DerzPlates does a bit more than that but I won&rsquo;t dump all of the code here.
Instead, I&rsquo;ll just a give you a sample of what addon code looks like.
Here is the main decision logic: it decides whether a given nameplate should use my special color or fallback to its default color.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- This is a custom implementation of the CompactUnitFrame_UpdateHealthColorOverride</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- function. Once setup, this gets called whenever CompactUnitFrame_UpdateHealthColor</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- gets called in order to alter the nameplate&#39;s color. If our override function returns</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- false, then the default coloring code with run. If it returns true, then our color</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- will be used instead.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>UpdateHealthColorOverride</span>(self)
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- Prefer self.displayedUnit but fallback to self.unit if necessary.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>local</span> unit <span style=color:#f92672>=</span> self.displayedUnit <span style=color:#f92672>or</span> self.unit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- Don&#39;t change the nameplate color for players.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> UnitIsPlayer(unit) <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- Don&#39;t change the nameplate color for units you cannot attack.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> UnitCanAttack(<span style=color:#e6db74>&#34;player&#34;</span>, unit) <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- UnitThreatSituation returns 3 if the player has the highest threat</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- and is the primary target of a given unit.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>local</span> isTanking <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- Check if the player is currently tanking the nameplate&#39;s unit.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>local</span> status <span style=color:#f92672>=</span> UnitThreatSituation(<span style=color:#e6db74>&#34;player&#34;</span>, unit)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> status <span style=color:#f92672>==</span> isTanking <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- If they ARE tanking this unit, set the plate&#39;s color to magenta.</span>
</span></span><span style=display:flex><span>		self.healthBar:SetStatusBarColor(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- Overwrite saved color so CompactUnitFrame_UpdateHealthColor() can restore the default later.</span>
</span></span><span style=display:flex><span>		self.healthBar.r, self.healthBar.g, self.healthBar.b <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- Signal CompactUnitFrame_UpdateHealthColor() that we set the color ourselves.</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- If we got here, we want CompactUnitFrame_UpdateHealthColor() to apply its default color.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>In my opinion, Lua is pretty readable!
I haven&rsquo;t written it for a while but I did use it for a few projects back in college.
I also did a <a href=https://love2d.org/ class=external-link target=_blank rel=noopener>Love2D</a> (a Lua 2D game development framework) <a href=https://github.com/theandrew168/lovejam2023 class=external-link target=_blank rel=noopener>game jam</a> last year so my Lua skills aren&rsquo;t as dull as they otherwise would&rsquo;ve been.</p><h1 id=development-struggles>Development Struggles
<a class=heading-link href=#development-struggles><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>At first, I thought that writing the addon would be quite trivial:</p><ol><li>Listen for a few specific events: nameplate created and threat situation updated.</li><li>When these events occur, loop through every nameplate visible on the screen.</li><li>If the nameplate belongs to a unit that is attacking me, change its color!</li></ol><p>This did get me to a mostly working (but buggy) iteration of the addon.
It wasn&rsquo;t perfect, however, and I quickly hit a snag.
You see, in the WoW client, nameplates are &ldquo;pooled&rdquo;.
This means that instead of creating and destroying nameplates objects for each unit, they are reused from a pre-allocated pool (similar to database connections).
A downside of this is that once you change a plate&rsquo;s color, it could get reused for a different unit and end up showing the wrong color.
After spending a few hours trying to find any information regarding this behavior (documentation for the WoW Lua API can be a bit sparse), I was close to giving up.</p><p>In an act of desperation, I summarized and posted my struggles onto the <a href="https://www.wowinterface.com/forums/showthread.php?p=344701" class=external-link target=_blank rel=noopener>WoW Interface forums</a>.
Amazingly, this community showed up a in huge way!
Super big thanks to SDPhantom for providing what might be the best and most helpful technical answer I&rsquo;ve ever received from a stranger on the internet.
Their advice and guidance led me right to the behavior I wanted.
They even pointed out how my initial usage of the event system was prone to race conditions and presented a better alternative.
Thanks to SDPhantom, I was able to release a much more stable v0.0.2.</p><p>This did make me wonder, though: how do developers learn this stuff?
How did SDPhantom instantly know what was wrong with my code and how to fix it?
Surely experience plays a role but what about examples and documentation?
From what I understand, there are two primary resources:</p><ol><li>The <a href=https://warcraft.wiki.gg/wiki/Warcraft_Wiki:Interface_customization class=external-link target=_blank rel=noopener>Warcraft Wiki</a></li><li>The Blizzard UI <a href=https://github.com/tomrus88/BlizzardInterfaceCode/tree/classic class=external-link target=_blank rel=noopener>source code</a></li></ol><p>When writing new addons, programmers will often scour the existing code to get a sense of how it works.
Then, they can apply this knowledge to identify where and how their logic should hook in and override default behavior.</p><h1 id=automation>Automation
<a class=heading-link href=#automation><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The code itself is hosted on GitHub.
I wrote a quick <a href=https://github.com/theandrew168/derzplates/blob/main/.github/workflows/release.yml class=external-link target=_blank rel=noopener>GitHub Action</a> to zip the addon code and create a release whenever a new tag is added.
I don&rsquo;t write new actions very often so I always have to revisit the docs and my previous workflows to relearn.
The heavy lifting of this particular action is handled by the <a href=https://github.com/TheDoctor0/zip-release class=external-link target=_blank rel=noopener>TheDoctor0/zip-release</a> and <a href=https://github.com/ncipollo/release-action class=external-link target=_blank rel=noopener>ncipollo/release-action</a> actions.
Being able to compose these simple and specific building blocks together to create specialized workflows is really awesome!</p><p>If you want to download the addon and try it for yourself, just grab the latest <code>DerzFiles.zip</code> file from the <a href=https://github.com/theandrew168/derzplates/releases class=external-link target=_blank rel=noopener>releases page</a> and unzip it into your addons folder.
Let me know if you end up giving it a shot!</p><p><img src=/images/20241222/release.webp alt="Screenshot of a recent release"></p><h1 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Overall, this has been a short, fun, and only mildly frustrating experience.
If it weren&rsquo;t for the nameplate pooling behavior, I would&rsquo;ve had this completely done and sorted within an hour.
However, troubleshooting the pooling cost me quite a few hours.
Thankfully, SDPhantom and the WoW Interface forum community showed up to help me out.
With their support, I was able to get everything working before the project turned into a stressful time sink.</p><p>I might iterate on DerzPlates in the future.
For v0.0.3, I&rsquo;d like to add a super simple settings page where players can tweak the &ldquo;you have threat&rdquo; color.
While I personally love the magenta, other players might prefer something else.
I might even write <em>more</em> addons if I find other preferences or behaviors that the default UI lacks.
I suppose time will tell.</p><p>Thanks for reading and may the winds guide you!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2025
Andrew Dailey
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script data-goatcounter=https://shallowbrooksoftware.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>