<!doctype html><html lang=en><head><title>A Multi-Platform Modern WebGL Demo · Shallow Brook Software
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Andrew Dailey"><meta name=description content="Nearly four years ago I wrote a blog post about a native, cross-platform OpenGL demo that I&rsquo;d written. That post (which was only my second ever) was actually a response to another blog post written by Chris Wellons (aka null program) on the same topic. Back then, I spent hours and hours just trying to figure out how I could write (and compile) a single C program that would run on all three major platforms: Windows, macOS, and Linux."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="A Multi-Platform Modern WebGL Demo"><meta name=twitter:description content="Nearly four years ago I wrote a blog post about a native, cross-platform OpenGL demo that I’d written. That post (which was only my second ever) was actually a response to another blog post written by Chris Wellons (aka null program) on the same topic. Back then, I spent hours and hours just trying to figure out how I could write (and compile) a single C program that would run on all three major platforms: Windows, macOS, and Linux."><meta property="og:url" content="https://shallowbrooksoftware.com/posts/a-multi-platform-modern-webgl-demo/"><meta property="og:site_name" content="Shallow Brook Software"><meta property="og:title" content="A Multi-Platform Modern WebGL Demo"><meta property="og:description" content="Nearly four years ago I wrote a blog post about a native, cross-platform OpenGL demo that I’d written. That post (which was only my second ever) was actually a response to another blog post written by Chris Wellons (aka null program) on the same topic. Back then, I spent hours and hours just trying to figure out how I could write (and compile) a single C program that would run on all three major platforms: Windows, macOS, and Linux."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-31T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-31T00:00:00+00:00"><meta property="article:tag" content="TypeScript"><meta property="article:tag" content="WebGL"><meta property="article:tag" content="Graphics"><link rel=canonical href=https://shallowbrooksoftware.com/posts/a-multi-platform-modern-webgl-demo/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://shallowbrooksoftware.com/>Shallow Brook Software
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://shallowbrooksoftware.com/posts/a-multi-platform-modern-webgl-demo/>A Multi-Platform Modern WebGL Demo</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-03-31T00:00:00Z>March 31, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/typescript/>TypeScript</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/webgl/>WebGL</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/graphics/>Graphics</a></span></div></div></header><div class=post-content><p>Nearly four years ago I wrote a <a href=/posts/a-multi-platform-modern-opengl-demo-with-sdl2/>blog post</a> about a native, cross-platform OpenGL demo that I&rsquo;d written.
That post (which was only my second ever) was actually a response to <em>another</em> <a href=https://nullprogram.com/blog/2015/06/06/ class=external-link target=_blank rel=noopener>blog post</a> written by Chris Wellons (aka <a href=https://nullprogram.com/ class=external-link target=_blank rel=noopener>null program</a>) on the same topic.
Back then, I spent <strong>hours and hours</strong> just trying to figure out how I could write (and compile) a single C program that would run on all three major platforms: Windows, macOS, and Linux.
Chris used <a href=https://www.glfw.org/ class=external-link target=_blank rel=noopener>GLFW3</a> to solve this problem while mine used <a href=https://www.libsdl.org/ class=external-link target=_blank rel=noopener>SDL2</a> (both are valid options).
Here is a screenshot of the demo for reference:</p><div style=display:flex;justify-content:center><img src=/images/sdl2-opengl-demo.webp alt="SDL2 OpenGL Demo"></div><p>While not particularly fancy, <a href=https://github.com/theandrew168/sdl2-opengl-demo class=external-link target=_blank rel=noopener>the code</a> serves as a decent foundation for writing this type of program.
I read through it the other day and wondered if I could <strong>rebuild the same application in a way that was easier to share</strong> with others&mldr;</p><h1 id=enter-webgl>Enter WebGL
<a class=heading-link href=#enter-webgl><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Lately, I&rsquo;ve been quite interested in <a href=https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API class=external-link target=_blank rel=noopener>WebGL</a> and how it trades top-end performance for the complete elimination of <em>all</em> distribution woes.
I even touched on this topic in a <a href=/posts/why-write/#webgl-rocks>previous post</a>.
In summary: WebGL allows you to build graphical applications (such as games) that are written in JavaScript and are executed directly in the user&rsquo;s browser.
They don&rsquo;t need to download any files, install anything, or tell their computer to trust an untrusted executable (everyone gets suspicous when they hear: &ldquo;Oh yeah, just ignore the virus warnings!&rdquo;).</p><p>These days, simple graphics programs are incredibly easy to create and distribute via the modern browser.
You can throw some JS+WebGL onto an HTML page, host it on a web server, and have it be instantly accessible by anyone with an internet connection.
People from anywhere in the world (and on any operating system) can <strong>simply click on a link and experience the content!</strong>
In fact, just by visiting this page, the new version of the demo has already been delivered to your machine!
Look forward to seeing that at the end of this post.</p><h1 id=code-structure>Code Structure
<a class=heading-link href=#code-structure><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>This is a pretty bare-bones WebGL demo without too many abstractions in place.
I did write a few helpers for things like resizing the canvas and building shader programs, however.
The demo uses a single shader to draw and rotate a red square.
A single buffer is used to hold all four of the square&rsquo;s vertices (2D points, one for each corner).
The program starts by querying for an <a href=https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API class=external-link target=_blank rel=noopener>HTML canvas element</a> that is included just before the script.
Then, it asks the canvas (and the browser) for a WebGL context and gets to work!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span>&lt;<span style=color:#f92672>canvas</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;glcanvas&#34;</span> <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;640&#34;</span> <span style=color:#a6e22e>height</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;640&#34;</span>&gt;&lt;/<span style=color:#f92672>canvas</span>&gt;;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>canvas</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#34;#glcanvas&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>gl</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>getContext</span>(<span style=color:#e6db74>&#34;webgl2&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// load shaders
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// buffer geometry
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// start the draw loop
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>main</span>();
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>After building the shader and buffering the square&rsquo;s geometry, the program starts the draw loop.
A WebGL-based draw loop utilizes <a href=https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame class=external-link target=_blank rel=noopener>requestAnimationFrame</a> to let the browser decide <em>when</em> to draw a frame.
It&rsquo;ll usually match your screen&rsquo;s refresh rate but could change depending on how the browser chooses to allocate its resources.
From the docs:</p><blockquote><p>The frequency of calls to the callback function will generally match the display refresh rate. The most common refresh rate is 60hz, (60 cycles/frames per second), though 75hz, 120hz, and 144hz are also widely used. requestAnimationFrame() calls are paused in most browsers when running in background tabs or hidden iframe&rsquo;s, in order to improve performance and battery life.</p></blockquote><p>To start the loop, you call this function with a function of your own that is responsible for drawing the scene.
Additionally, your drawing function must be sure to call <code>requestAnimationFrame</code> again at the end to queue up the next frame and continue the loop.
Essentially, your draw function and <code>requestAnimationFrame</code> form an infinite loop by continuously calling each other.
Pretty neat, huh?
In short:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// activate our shader and buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// update the square&#39;s rotation value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// clear the canvas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// draw the square
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// tell the browser to call our draw function again
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>draw</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// kick off the loop by telling the browser to call our draw function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>draw</span>);
</span></span></code></pre></div><h1 id=the-demo>The Demo
<a class=heading-link href=#the-demo><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Enough talk, let&rsquo;s see this thing!</p><div style=display:flex;justify-content:center><canvas id=glcanvas width=640 height=640 style=max-width:100%></canvas></div><script>function resizeGL(e){const s=e.canvas,t=s.clientWidth,n=s.clientHeight;(e.canvas.width!=t||e.canvas.height!=n)&&(e.canvas.width=t,e.canvas.height=n,e.viewport(0,0,t,n))}function compileShader(e,t,n){if(e.shaderSource(t,n),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(t))}function linkProgram(e,t,n,s){if(e.attachShader(t,n),e.attachShader(t,s),e.linkProgram(t),!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(t));e.detachShader(t,n),e.detachShader(t,s)}function compileAndLinkShader(e,t,n){const s=e.createShader(e.VERTEX_SHADER);compileShader(e,s,t);const o=e.createShader(e.FRAGMENT_SHADER);compileShader(e,o,n);const i=e.createProgram();return linkProgram(e,i,s,o),e.deleteShader(s),e.deleteShader(o),i}function main(){const o=document.querySelector("#glcanvas"),e=o.getContext("webgl2");if(e===null){const e="Unable to initialize WebGL2. Your browser or machine may not support it.";throw new Error(e)}console.log(`WebGL Vendor:   %s
`,e.getParameter(e.VENDOR)),console.log(`WebGL Renderer: %s
`,e.getParameter(e.RENDERER)),console.log(`WebGL Version:  %s
`,e.getParameter(e.VERSION)),console.log(`GLSL Version:   %s
`,e.getParameter(e.SHADING_LANGUAGE_VERSION));const i=`
		    #version 300 es

			in vec2 aPosition;

			uniform float uAngle;

			void main() {
				mat2 rotate = mat2(cos(uAngle), -sin(uAngle), sin(uAngle), cos(uAngle));
				gl_Position = vec4(0.75 * rotate * aPosition, 0.0, 1.0);
			}
		`,a=`
		    #version 300 es
			precision highp float;

			out vec4 vColor;

			void main() {
			    vColor = vec4(1, 0.15, 0.15, 1);
			}
		`,t=compileAndLinkShader(e,i.trim(),a.trim()),r=e.getUniformLocation(t,"uAngle"),c=[-1,1,-1,-1,1,1,1,-1],n=e.createVertexArray();e.bindVertexArray(n);const l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(c),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,8,0),e.bindVertexArray(null);function s(o){resizeGL(e),e.clearColor(.15,.15,.15,1),e.clear(e.COLOR_BUFFER_BIT);const i=o/1e3;e.useProgram(t),e.uniform1f(r,i),e.bindVertexArray(n),e.drawArrays(e.TRIANGLE_STRIP,0,4),requestAnimationFrame(s)}requestAnimationFrame(s)}main()</script><p>Isn&rsquo;t it beautiful?
A simple graphics demo was distributed to your machine with the same ease and convenience as reading this blog post.
To reiterate the sentiment from my previous post about WebGL:</p><blockquote><p>While the upper bounds of performance are certainly lower when using a browser-based, JavaScript-based graphics programming environment, I don&rsquo;t think that it impacts me very much.
I don&rsquo;t plan on creating anything incredibly large or high fidelity: just basic games and examples.
If completely solving the problem of distribution means sacrificing a bit of performance, then I&rsquo;m satisfied.</p></blockquote><p>Thanks for reading!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2024
Andrew Dailey
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>